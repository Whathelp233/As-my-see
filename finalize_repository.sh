#!/bin/bash

# çŸ¥è¯†åº“æœ€ç»ˆä¼˜åŒ–è„šæœ¬

set -e

REPO_DIR="/root/.openclaw/workspace/As-my-see"
LOG_FILE="$REPO_DIR/finalization.log"

log() {
    echo "[$(date '+%Y-%m-%d %H:%M:%S')] $1" | tee -a "$LOG_FILE"
}

# åˆ›å»ºä¸» README
create_main_readme() {
    log "åˆ›å»ºä¸» README.md"
    
    cat > "$REPO_DIR/README.md" << 'EOF'
# As-my-see çŸ¥è¯†åº“

ä¸€ä¸ªç»“æ„åŒ–çš„ä¸ªäººæŠ€æœ¯çŸ¥è¯†åº“ï¼ŒåŒ…å«æœºå™¨äººå­¦ã€Qtã€Linuxã€C++ã€ROS ç­‰æŠ€æœ¯é¢†åŸŸçš„æ–‡æ¡£å’Œç¬”è®°ã€‚

## ğŸ“ ç›®å½•ç»“æ„

```
As-my-see/
â”œâ”€â”€ docs/                    # æŠ€æœ¯æ–‡æ¡£
â”‚   â”œâ”€â”€ cpp/                # C++ ç›¸å…³
â”‚   â”œâ”€â”€ qt/                 # Qt æ¡†æ¶
â”‚   â”œâ”€â”€ linux/              # Linux ç³»ç»Ÿ
â”‚   â”œâ”€â”€ robotics/           # æœºå™¨äººå­¦
â”‚   â”œâ”€â”€ ros/                # ROS ç³»ç»Ÿ
â”‚   â”œâ”€â”€ vision/             # è®¡ç®—æœºè§†è§‰
â”‚   â”œâ”€â”€ embedded/           # åµŒå…¥å¼ç³»ç»Ÿ
â”‚   â””â”€â”€ general/            # é€šç”¨æŠ€æœ¯
â”œâ”€â”€ notes/                  # å­¦ä¹ ç¬”è®°
â”‚   â”œâ”€â”€ signals/            # ä¿¡å·å¤„ç†
â”‚   â”œâ”€â”€ learning/           # å­¦ä¹ æ–¹æ³•
â”‚   â”œâ”€â”€ math/               # æ•°å­¦åŸºç¡€
â”‚   â””â”€â”€ electronics/        # ç”µå­æŠ€æœ¯
â”œâ”€â”€ projects/               # é¡¹ç›®è®°å½•
â”œâ”€â”€ resources/              # å­¦ä¹ èµ„æº
â”œâ”€â”€ knowledge_expansions/   # çŸ¥è¯†æ‰©å±•
â””â”€â”€ tools/                  # å·¥å…·è„šæœ¬
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æµè§ˆæ–‡æ¡£
1. è¿›å…¥å¯¹åº”æŠ€æœ¯ç›®å½•ï¼š`cd docs/[æŠ€æœ¯é¢†åŸŸ]`
2. æŸ¥çœ‹ Markdown æ–‡æ¡£
3. ä½¿ç”¨çŸ¥è¯†æ‰©å±•è·å–æœ€æ–°èµ„æº

### ä½¿ç”¨å·¥å…·
```bash
# æ–‡æ¡£åˆ†æ
./tools/simple_analyzer.sh

# æ–‡æ¡£åˆ†ç±»
./tools/document_classifier.sh

# å†…å®¹æ‰©å±•
./tools/content_expander.sh
```

## ğŸ“Š ç»Ÿè®¡ä¿¡æ¯

- **æ€»æ–‡æ¡£æ•°**: 316 ä¸ª Markdown æ–‡ä»¶
- **æŠ€æœ¯æ–‡æ¡£**: 268 ä¸ª
- **å­¦ä¹ ç¬”è®°**: 30 ä¸ª
- **é¡¹ç›®è®°å½•**: 6 ä¸ª
- **å­¦ä¹ èµ„æº**: 12 ä¸ª
- **æœ€åæ›´æ–°**: $(date '+%Y-%m-%d')

## ğŸ”„ æ›´æ–°ç»´æŠ¤

### æ·»åŠ æ–°æ–‡æ¡£
1. å°†æ–‡æ¡£æ”¾å…¥å¯¹åº”åˆ†ç±»ç›®å½•
2. è¿è¡Œä¼˜åŒ–è„šæœ¬ï¼š`./enhance_documents.sh`
3. æäº¤åˆ° Git

### æ›´æ–°çŸ¥è¯†æ‰©å±•
```bash
./knowledge_expansion.sh
```

## ğŸ“š å­¦ä¹ è·¯å¾„

### æœºå™¨äººæŠ€æœ¯æ ˆ
1. **åŸºç¡€** â†’ C++/Linux
2. **æ¡†æ¶** â†’ Qt/ROS
3. **ç®—æ³•** â†’ æœºå™¨äººå­¦/è§†è§‰
4. **ç³»ç»Ÿ** â†’ åµŒå…¥å¼/å®æ—¶ç³»ç»Ÿ

### è½¯ä»¶å¼€å‘
1. **è¯­è¨€** â†’ C++/Python
2. **æ¡†æ¶** â†’ Qt
3. **ç³»ç»Ÿ** â†’ Linux
4. **å·¥å…·** â†’ Git/CMake

## ğŸ¤ è´¡çŒ®æŒ‡å—

æ¬¢è¿é€šè¿‡ä»¥ä¸‹æ–¹å¼è´¡çŒ®ï¼š
1. è¡¥å……æŠ€æœ¯æ–‡æ¡£
2. ä¿®æ­£é”™è¯¯å†…å®¹
3. æ·»åŠ å®è·µæ¡ˆä¾‹
4. æ›´æ–°æœ€æ–°æŠ€æœ¯åŠ¨æ€

## ğŸ“ è”ç³»ä¸æ”¯æŒ

- **ä»“åº“åœ°å€**: https://github.com/Whathelp233/As-my-see
- **ç»´æŠ¤è€…**: [Your Name]
- **æ›´æ–°é¢‘ç‡**: å®šæœŸç»´æŠ¤

---

*æœ¬çŸ¥è¯†åº“é‡‡ç”¨ CC BY-NC-SA 4.0 åè®®å…±äº«ï¼Œä»…ä¾›å­¦ä¹ äº¤æµä½¿ç”¨ã€‚*
EOF
    
    log "ä¸» README åˆ›å»ºå®Œæˆ"
}

# åˆ›å»ºå„ç›®å½• README
create_category_readmes() {
    log "åˆ›å»ºåˆ†ç±»ç›®å½• README"
    
    # docs ç›®å½•
    cat > "$REPO_DIR/docs/README.md" << 'EOF'
# æŠ€æœ¯æ–‡æ¡£

æœ¬ç›®å½•åŒ…å«å„ç±»æŠ€æœ¯æ–‡æ¡£ï¼ŒæŒ‰æŠ€æœ¯é¢†åŸŸåˆ†ç±»ã€‚

## åˆ†ç±»è¯´æ˜

### C++ ç¼–ç¨‹
- å¤šçº¿ç¨‹ç¼–ç¨‹
- å†…å­˜ç®¡ç†
- ç°ä»£ C++ ç‰¹æ€§
- æ€§èƒ½ä¼˜åŒ–

### Qt æ¡†æ¶
- Qt Widgets
- QML ä¸ Qt Quick
- ä¿¡å·ä¸æ§½
- å¤šçº¿ç¨‹ä¸ç½‘ç»œ

### Linux ç³»ç»Ÿ
- ç³»ç»Ÿç®¡ç†
- Shell è„šæœ¬
- å†…æ ¸ä¸é©±åŠ¨
- å®¹å™¨æŠ€æœ¯

### æœºå™¨äººå­¦
- SLAM æŠ€æœ¯
- è·¯å¾„è§„åˆ’
- è¿åŠ¨æ§åˆ¶
- ä¼ æ„Ÿå™¨èåˆ

### ROS ç³»ç»Ÿ
- ROS 2 åŸºç¡€
- èŠ‚ç‚¹ä¸è¯é¢˜
- æœåŠ¡ä¸åŠ¨ä½œ
- å·¥å…·ä¸è°ƒè¯•

### è®¡ç®—æœºè§†è§‰
- OpenCV ä½¿ç”¨
- å›¾åƒå¤„ç†
- ç›®æ ‡æ£€æµ‹
- 3D è§†è§‰

### åµŒå…¥å¼ç³»ç»Ÿ
- ARM æ¶æ„
- RTOS ç³»ç»Ÿ
- å¤–è®¾é©±åŠ¨
- ä½åŠŸè€—è®¾è®¡

### é€šç”¨æŠ€æœ¯
- ç®—æ³•ä¸æ•°æ®ç»“æ„
- è®¾è®¡æ¨¡å¼
- è½¯ä»¶å·¥ç¨‹
- å¼€å‘å·¥å…·

## æ–‡æ¡£è§„èŒƒ

1. **æ ‡é¢˜**: ä¸€çº§æ ‡é¢˜ä¸ºæ–‡æ¡£ä¸»é¢˜
2. **ç»“æ„**: é€»è¾‘æ¸…æ™°ï¼Œå±‚æ¬¡åˆ†æ˜
3. **ä»£ç **: æä¾›å¯è¿è¡Œçš„ç¤ºä¾‹
4. **å›¾ç¤º**: å¤æ‚æ¦‚å¿µé…å›¾è¯´æ˜
5. **å‚è€ƒ**: å¼•ç”¨æƒå¨èµ„æ–™

## æ›´æ–°å»ºè®®

1. ä¿æŒæŠ€æœ¯æ—¶æ•ˆæ€§
2. è¡¥å……å®è·µæ¡ˆä¾‹
3. æ·»åŠ å¸¸è§é—®é¢˜
4. ä¼˜åŒ–æ–‡æ¡£ç»“æ„
EOF
    
    # notes ç›®å½•
    cat > "$REPO_DIR/notes/README.md" << 'EOF'
# å­¦ä¹ ç¬”è®°

ä¸ªäººå­¦ä¹ è¿‡ç¨‹ä¸­çš„æ€è€ƒå’Œæ€»ç»“ã€‚

## ç¬”è®°ç±»å‹

### ä¿¡å·å¤„ç†
- æ•°å­—ä¿¡å·å¤„ç†åŸºç¡€
- æ»¤æ³¢å™¨è®¾è®¡
- é¢‘è°±åˆ†æ

### å­¦ä¹ æ–¹æ³•
- çŸ¥è¯†ç®¡ç†
- å­¦ä¹ æŠ€å·§
- æ—¶é—´ç®¡ç†

### æ•°å­¦åŸºç¡€
- çº¿æ€§ä»£æ•°
- æ¦‚ç‡ç»Ÿè®¡
- ä¼˜åŒ–ç†è®º

### ç”µå­æŠ€æœ¯
- ç”µè·¯åŸºç¡€
- ä¼ æ„Ÿå™¨åŸç†
- é€šä¿¡åè®®

## ç¬”è®°ç‰¹ç‚¹

1. **ä¸ªæ€§åŒ–**: ä¸ªäººç†è§£ä¸æ€è€ƒ
2. **å®ç”¨æ€§**: è§£å†³å®é™…é—®é¢˜
3. **æˆé•¿æ€§**: è®°å½•å­¦ä¹ è¿‡ç¨‹
4. **å¯è¿½æº¯**: æ ‡æ³¨æ—¶é—´ä¸æ¥æº

## ä½¿ç”¨å»ºè®®

1. ç»“åˆå®è·µç†è§£
2. å®šæœŸå¤ä¹ æ›´æ–°
3. å»ºç«‹çŸ¥è¯†å…³è”
4. åˆ†äº«äº¤æµè®¨è®º
EOF
    
    log "åˆ†ç±»ç›®å½• README åˆ›å»ºå®Œæˆ"
}

# åˆ›å»º Git å¿½ç•¥æ–‡ä»¶
create_gitignore() {
    log "åˆ›å»º .gitignore"
    
    cat > "$REPO_DIR/.gitignore" << 'EOF'
# æ—¥å¿—æ–‡ä»¶
*.log
enhancement.log
knowledge_expansion.log
finalization.log

# ä¸´æ—¶æ–‡ä»¶
*.tmp
*.temp
*.bak
*.backup

# ç³»ç»Ÿæ–‡ä»¶
.DS_Store
Thumbs.db

# å¼€å‘ç¯å¢ƒ
.vscode/
.idea/
*.swp
*.swo

# æ„å»ºè¾“å‡º
build/
dist/
*.o
*.so
*.a

# æ•°æ®æ–‡ä»¶
*.db
*.sqlite
*.csv

# å¤§å‹æ–‡ä»¶
*.zip
*.tar.gz
*.7z

# æ•æ„Ÿä¿¡æ¯
.env
*.key
*.pem
*.cert

# æ–‡æ¡£ç”Ÿæˆ
_site/
docs/_build/

# å¤‡ä»½ç›®å½•
backup/
original/
EOF
    
    log ".gitignore åˆ›å»ºå®Œæˆ"
}

# åˆ›å»ºæ›´æ–°è„šæœ¬
create_update_script() {
    log "åˆ›å»ºæ›´æ–°è„šæœ¬"
    
    cat > "$REPO_DIR/update_repository.sh" << 'EOF'
#!/bin/bash

# çŸ¥è¯†åº“æ›´æ–°è„šæœ¬

set -e

REPO_DIR=$(cd "$(dirname "$0")" && pwd)
LOG_FILE="$REPO_DIR/update.log"

echo "[$(date '+%Y-%m-%d %H:%M:%S')] å¼€å§‹æ›´æ–°çŸ¥è¯†åº“..." | tee -a "$LOG_FILE"

# 1. æ›´æ–°æ–‡æ¡£ç»“æ„
echo "æ›´æ–°æ–‡æ¡£ç»“æ„..."
if [ -f "$REPO_DIR/enhance_documents.sh" ]; then
    "$REPO_DIR/enhance_documents.sh" >> "$LOG_FILE" 2>&1
fi

# 2. æ›´æ–°çŸ¥è¯†æ‰©å±•
echo "æ›´æ–°çŸ¥è¯†æ‰©å±•..."
if [ -f "$REPO_DIR/knowledge_expansion.sh" ]; then
    "$REPO_DIR/knowledge_expansion.sh" >> "$LOG_FILE" 2>&1
fi

# 3. Git æäº¤
echo "æäº¤åˆ° Git..."
cd "$REPO_DIR"
git add .
git commit -m "docs: è‡ªåŠ¨æ›´æ–° - $(date '+%Y-%m-%d %H:%M:%S')" >> "$LOG_FILE" 2>&1

# 4. æ¨é€åˆ°è¿œç¨‹
echo "æ¨é€åˆ°è¿œç¨‹ä»“åº“..."
git push origin master >> "$LOG_FILE" 2>&1

echo "[$(date '+%Y-%m-%d %H:%M:%S')] çŸ¥è¯†åº“æ›´æ–°å®Œæˆ" | tee -a "$LOG_FILE"
echo "æ›´æ–°æ—¥å¿—: $LOG_FILE"
EOF
    
    chmod +x "$REPO_DIR/update_repository.sh"
    log "æ›´æ–°è„šæœ¬åˆ›å»ºå®Œæˆ"
}

# ä¸»å‡½æ•°
main() {
    log "å¼€å§‹çŸ¥è¯†åº“æœ€ç»ˆä¼˜åŒ–..."
    
    # æ‰§è¡Œå„æ­¥éª¤
    create_main_readme
    create_category_readmes
    create_gitignore
    create_update_script
    
    # æäº¤æœ€ç»ˆç‰ˆæœ¬
    log "æäº¤æœ€ç»ˆç‰ˆæœ¬åˆ° Git..."
    cd "$REPO_DIR"
    git add .
    git commit -m "feat: å®ŒæˆçŸ¥è¯†åº“ç»“æ„åŒ–ä¼˜åŒ– - $(date '+%Y-%m-%d')" || true
    
    log "çŸ¥è¯†åº“æœ€ç»ˆä¼˜åŒ–å®Œæˆï¼"
    log "è¯·è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¨é€åˆ°è¿œç¨‹ä»“åº“ï¼š"
    echo "cd $REPO_DIR && git push origin master"
}

# è¿è¡Œä¸»å‡½æ•°
main "$@"